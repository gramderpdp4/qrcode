<template>
    <div class="sheet-modal" style="height: 45vh !important; background-color: #2E2E2E;">
        <div class="toolbar theme-white color-theme" style="background-color: #2E2E2E;" >
          <div class="toolbar-inner">
            <div class="left" style="color: white; margin-left: 3vw;">Comentários</div>
            <div class="right">
              <a class="link sheet-close">Fechar</a>
            </div>
          </div>
        </div>
        <div class="sheet-modal-inner theme-white color-theme-white" >
           <div id="comments_item" class="page-content" style="padding-bottom: 13vh; position: relative"></div>
            <div class="list no-hairlines-md theme-dark" style="position: fixed; bottom: 0; margin: 0;">
                <ul style="background-color: transparent;">
                  <li class="item-content item-input item-input-outline" style="height: 4rem;background: rgb(46, 46, 46);">
                    <div class="item-inner" style="padding-bottom: 0.3rem;">
                      <div class="item-input-wrap">
                        <textarea id="comment_item" class="resizable" style="width: 91vw;" placeholder="Adicionar comentário"></textarea>
                        <div id="send_comment" style="display: none; position: absolute; left: 80vw; bottom: 0;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: white"><path d="m21.426 11.095-17-8A.999.999 0 0 0 3.03 4.242L4.969 12 3.03 19.758a.998.998 0 0 0 1.396 1.147l17-8a1 1 0 0 0 0-1.81zM5.481 18.197l.839-3.357L12 12 6.32 9.16l-.839-3.357L18.651 12l-13.17 6.197z"></path></svg>
                        </div>
                      </div>
                      <a href="" class="button button-fill" id="send_comment" style="display: none;">Comentar</a>
                    </div>
                  </li>
                </ul>
            </div>
        </div>
      </div>
    </template>
    <script>
      export default function (props, {$f7, $on, $onBeforeMount, $onMounted, $onBeforeUnmount, $onUnmounted }) {
        // Component Data
        let name = 'Jimmy';
        let age = 25;
        let likes = ['Tennis', 'Chess', 'Football'];
    
        // Component Methods
        const openAlert = () => {
          $f7.dialog.alert('Hello World');
        }
    
        // Lifecycle
        $onBeforeMount(() => {
          
 
        });
        $onMounted(() => {
            let $button_comment = document.getElementById("send_comment"),
                $comment_container = document.getElementById("comment_item");

                $comment_container.addEventListener("keyup", function(){
                    if(this.value.length > 3){
                        $button_comment.style.display = "block"
                    }else{
                        $button_comment.style.display = "none"
                    }
                })

            $button_comment.addEventListener("click", function(){
                let $comment_value = document.getElementById("comment_item").value,
                $cont_key = document.getElementById("item-comment"),
                $get_key = $cont_key.getAttribute("data-id-item"),
                $name_session = sessionStorage.getItem("user_name_login"),
                $ref_comment = databases.ref("/comentarios/");

                let $comment_params = {
                    comentario: $comment_value,
                    nome_comment: $name_session,
                    key_product: $get_key
                }

                $ref_comment.push($comment_params)
                .then(function(){
                   $("#comment_item").val("")
                   var toast = app.toast.create({
                        text: 'Obrigado por comentar :)',
                        closeTimeout: 3000,
                        position: "center"
                    });

                    $button_comment.style.display = "none"

                    toast.open()
                })
                .catch(function(err){
                    alert(err)
                })
            })

        });
        $onBeforeUnmount(() => {
        
        });
        $onUnmounted(() => {
         
        });
    
        // Page Events
        $on('pageMounted', (e, page) => {
          console.log('pageMounted', page);
        });
        $on('pageInit', (e, page) => {
          console.log('pageInit', page);
        });
        $on('pageBeforeIn', (e, page) => {
          console.log('pageBeforeIn', page);
        });
        $on('pageAfterIn', (e, page) => {
          console.log('pageAfterIn', page);
        });
        $on('pageBeforeOut', (e, page) => {
          console.log('pageBeforeOut', page);
        });
        $on('pageAfterOut', (e, page) => {
          console.log('pageAfterOut', page);
        });
        $on('pageBeforeRemove', (e, page) => {
          console.log('pageBeforeRemove', page);
        });
    
        // Return render function
        return $render;
      }
    </script>
    